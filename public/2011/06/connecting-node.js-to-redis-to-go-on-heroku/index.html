<!DOCTYPE html>



 <html class="no-js"> 
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="author" content="Jerod Santo">
    <meta property="og:site_name" content="Jerod Santo">
    
    <meta name="description" content="Heroku&rsquo;s new Cedar stack is awesome for many reasons, one of which is first-class Node.js hosting.
I&rsquo;m giving it a test run with an app that uses Redis for data caching and I couldn&rsquo;t find any documentation on how to connect a Node app to the Redis To Go add-on. Here&rsquo;s how I did it:
This assumes that you&rsquo;ve already created the Heroku app or don&rsquo;t need any help in doing so. Heroku has a great tutorial on how to deploy a Node app on Cedar.
First, add the Redis To Go add-on via the heroku command:">
    <meta property="st:title" content="Connecting Node.js to Redis To Go on Heroku">
    <meta property="og:title" content="Connecting Node.js to Redis To Go on Heroku">
    <meta property="og:description" content="Heroku&rsquo;s new Cedar stack is awesome for many reasons, one of which is first-class Node.js hosting.
I&rsquo;m giving it a test run with an app that uses Redis for data caching and I couldn&rsquo;t find any documentation on how to connect a Node app to the Redis To Go add-on. Here&rsquo;s how I did it:
This assumes that you&rsquo;ve already created the Heroku app or don&rsquo;t need any help in doing so. Heroku has a great tutorial on how to deploy a Node app on Cedar.
First, add the Redis To Go add-on via the heroku command:">
    <meta property="og:type" content="article">
    
    <meta property="og:image" content="/icon.png">
    
    
    <title>
      Connecting Node.js to Redis To Go on Heroku | Jerod Santo
    </title>

    <link rel="icon" href="/icon.png" sizes="256x256" type="image/png">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" type="text/css" media="all" href="/styles.css">
    <script>
       
      window.grunticon=function(e){if(e&&3===e.length){var t=window,n=!(!t.document.createElementNS||!t.document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect||!document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#Image","1.1")||window.opera&&-1===navigator.userAgent.indexOf("Chrome")),o=function(o){var r=t.document.createElement("link"),a=t.document.getElementsByTagName("script")[0];r.rel="stylesheet",r.href=e[o&&n?0:o?1:2],a.parentNode.insertBefore(r,a)},r=new t.Image;r.onerror=function(){o(!1)},r.onload=function(){o(1===r.width&&1===r.height)},r.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw=="}};
      grunticon(["/icons/icons.data.svg.css", "/icons/icons.data.png.css", "/icons/icons.fallback.css"]);
    </script>

    <link href='//fonts.googleapis.com/css?family=Roboto+Condensed:400italic,400' rel='stylesheet' type='text/css'>
    <script src="//use.typekit.net/ozg5mvx.js"></script>
    <script>try{Typekit.load();}catch(e){}</script>
    <script src="/js/modernizr-custom.js"></script>

    

    <link rel="alternate" type="application/atom+xml" href="/index.xml" />
  </head>
  <body class="">
    
    <div class="main-header">
      <h1>
        <a href="/" title="Home">
          <span class="big-dot">&middot;</span> Jerod Santo <span class="big-dot">&middot;</span>
        </a>
      </h1>
      <a href="javascript:void(0);" title="Moar" class="main-header-more">+</a>
      <a href="/archives/" title="View Blog Archives" class="main-header-archive">Archives</a>
      <a href="mailto:jerod.santo@gmail.com" title="Contact Jerod" class="main-header-contact">Contact</a>
      <a href="/search/" title="Search the site" class="main-header-search">Search</a>
    </div>
    

    
<article class="post">
  <header class="post-header">
    <h1>Connecting Node.js to Redis To Go on Heroku</h1>
    
    <p class="post-date">
      June 17, 2011
    </p>
  </header>

  

  <div class="post-content">
    <p>Heroku&rsquo;s new <a href="http://devcenter.heroku.com/articles/cedar">Cedar stack</a> is awesome for many reasons, one of which is first-class <a href="http://nodejs.org">Node.js</a> hosting.</p>
<p>I&rsquo;m giving it a test run with an app that uses <a href="http://redis.io">Redis</a> for data caching and I couldn&rsquo;t find any documentation on how to connect a Node app to the <a href="http://redistogo.com">Redis To Go</a> add-on. Here&rsquo;s how I did it:</p>
<div class="notice">This assumes that you&rsquo;ve already created the Heroku app or don&rsquo;t need any help in doing so. Heroku has a <a href="http://devcenter.heroku.com/articles/node-js">great tutorial</a> on how to deploy a Node app on Cedar.</div>
<p>First, add the Redis To Go add-on via the <code>heroku</code> command:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#1f2328">heroku addons:add redistogo
</span></span></span></code></pre></div><p>Installing the add-on will automatically add a <code>REDISTOGO_URL</code> environment variable to your app. You can see its value with the <code>heroku config</code> command.</p>
<p>The Redis client for Node that I use is <a href="https://github.com/mranney/node_redis">node_redis</a>, so the following is specific it for it. If you use another client, adjust as necessary.</p>
<p>When node_redis connects to a Redis instance on your local machine it assumes the default port and host information, so instantiating the client is as simple as this:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#cf222e">var</span> <span style="color:#1f2328">redis</span> <span style="color:#0550ae">=</span> <span style="color:#1f2328">require</span><span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;redis&#34;</span><span style="color:#1f2328">).</span><span style="color:#1f2328">createClient</span><span style="color:#1f2328">();</span>
</span></span></code></pre></div><p>That works just fine in development, but we need it to authenticate to Redis To Go in production. To handle both cases I just check for the existence of the <code>REDISTOGO_URL</code>, like so:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#cf222e">if</span> <span style="color:#1f2328">(</span><span style="color:#1f2328">process</span><span style="color:#1f2328">.</span><span style="color:#1f2328">env</span><span style="color:#1f2328">.</span><span style="color:#1f2328">REDISTOGO_URL</span><span style="color:#1f2328">)</span> <span style="color:#1f2328">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#57606a">// TODO: redistogo connection
</span></span></span><span style="display:flex;"><span><span style="color:#57606a"></span><span style="color:#1f2328">}</span> <span style="color:#cf222e">else</span> <span style="color:#1f2328">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#cf222e">var</span> <span style="color:#1f2328">redis</span> <span style="color:#0550ae">=</span> <span style="color:#1f2328">require</span><span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;redis&#34;</span><span style="color:#1f2328">).</span><span style="color:#1f2328">createClient</span><span style="color:#1f2328">();</span>
</span></span><span style="display:flex;"><span><span style="color:#1f2328">}</span>
</span></span></code></pre></div><p>Everything should still work fine in development, but we still need to implement the Redis To Go connection. To do this we need to extract the port, hostname, and authentication string from <code>REDISTOGO_URL</code> using Node&rsquo;s built-in <code>url</code> lib:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#57606a">// inside if statement
</span></span></span><span style="display:flex;"><span><span style="color:#57606a"></span><span style="color:#cf222e">var</span> <span style="color:#1f2328">rtg</span>   <span style="color:#0550ae">=</span> <span style="color:#1f2328">require</span><span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;url&#34;</span><span style="color:#1f2328">).</span><span style="color:#1f2328">parse</span><span style="color:#1f2328">(</span><span style="color:#1f2328">process</span><span style="color:#1f2328">.</span><span style="color:#1f2328">env</span><span style="color:#1f2328">.</span><span style="color:#1f2328">REDISTOGO_URL</span><span style="color:#1f2328">);</span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">var</span> <span style="color:#1f2328">redis</span> <span style="color:#0550ae">=</span> <span style="color:#1f2328">require</span><span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;redis&#34;</span><span style="color:#1f2328">).</span><span style="color:#1f2328">createClient</span><span style="color:#1f2328">(</span><span style="color:#1f2328">rtg</span><span style="color:#1f2328">.</span><span style="color:#1f2328">port</span><span style="color:#1f2328">,</span> <span style="color:#1f2328">rtg</span><span style="color:#1f2328">.</span><span style="color:#1f2328">hostname</span><span style="color:#1f2328">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#1f2328">redis</span><span style="color:#1f2328">.</span><span style="color:#1f2328">auth</span><span style="color:#1f2328">(</span><span style="color:#1f2328">rtg</span><span style="color:#1f2328">.</span><span style="color:#1f2328">auth</span><span style="color:#1f2328">.</span><span style="color:#1f2328">split</span><span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;:&#34;</span><span style="color:#1f2328">)[</span><span style="color:#0550ae">1</span><span style="color:#1f2328">]);</span>
</span></span></code></pre></div><p>For some reason Node&rsquo;s <code>url</code> lib won&rsquo;t split up the auth section&rsquo;s username and password, so that&rsquo;s what is going on in the <code>rtg.auth.split(&quot;:&quot;)[1]</code> that is passed to the auth command.</p>
<p>That&rsquo;s all it took to get my app connected and running smoothly. I hope this helps you do the same!</p>

  </div>

  <ul class="post-share-buttons">
    <li class="service_twitter post-share-1">
      <a class="icon-twitter" href="https://twitter.com/intent/tweet?url=http%3a%2f%2flocalhost%3a1313%2f2011%2f06%2fconnecting-node.js-to-redis-to-go-on-heroku%2f&via=jerodsanto&text=Connecting%20Node.js%20to%20Redis%20To%20Go%20on%20Heroku" title="Tweet">
        <span>Tweet</span>
      </a>
    </li>
    <li class="service_rss post-share-2">
      <a class="icon-rss" href="/index.xml" title="Subscribe to the feed!">
        <span>RSS</span>
      </a>
    </li>
    <li class="service_hackernews post-share-3">
      <a class="icon-hackernews" href="http://news.ycombinator.com/submitlink?u=http%3a%2f%2flocalhost%3a1313%2f2011%2f06%2fconnecting-node.js-to-redis-to-go-on-heroku%2f&t=Connecting%20Node.js%20to%20Redis%20To%20Go%20on%20Heroku" title="Post to Hacker News">
        <span>Hacker News</span>
      </a>
    </li>
    <li class="service_instapaper post-share-4">
      <a class="icon-instapaper" href="http://www.instapaper.com/hello2?url=http%3a%2f%2flocalhost%3a1313%2f2011%2f06%2fconnecting-node.js-to-redis-to-go-on-heroku%2f&title=Connecting%20Node.js%20to%20Redis%20To%20Go%20on%20Heroku" title="Read later">
        <span>Instapaper</span>
      </a>
    </li>
  </ul>

  
  

  <div id="disqus_thread"></div>
  <script>
    var disqus_url   = "http:\/\/localhost:1313\/2011\/06\/connecting-node.js-to-redis-to-go-on-heroku\/";
    var disqus_title = "Connecting Node.js to Redis To Go on Heroku";
    (function() {
     var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
     dsq.src = 'https://blogt0sk1.disqus.com/embed.js';
     (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>

  <script src="//platform.twitter.com/widgets.js"></script>
</article>


    <footer class="main-footer">
  <p>
    Copyright &copy; 2008&mdash;2025 Jerod Santo
  </p>
</footer>

    
    <script src="/js/compiled.js"></script>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-3287978-16', 'auto');
      ga('send', 'pageview');
    </script>
    
  </body>
</html>