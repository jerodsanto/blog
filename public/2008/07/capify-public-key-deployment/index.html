<!DOCTYPE html>



 <html class="no-js"> 
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="author" content="Jerod Santo">
    <meta property="og:site_name" content="Jerod Santo">
    
    <meta name="description" content="I’ve been playing with Capistrano a lot lately and loving it. Here is an example of how easy it is to write tasks and use them on multiple remote servers.
This task installs your SSH public key on the remote machine to allow key-based authentication:
set :key_file do
  Capistrano::CLI.ui.ask &#34;enter public key to push: &#34;
end

desc &#34;configures key-based SSH administration&#34;
task :push_key, :roles  =&gt; :all do
  key_location = File.expand_path(key_file)
  unless File.exist?(key_location) and key_file.match(/\.pub$/)
    puts &#34;Couldn&#39;t locate public key. Try again&#34;
    exit
  end
  key_file_name = File.basename(key_location)
  upload key_location, &#34;/tmp/#{key_file_name}&#34;
  run &#34;if [ ! -e ~/.ssh ];then mkdir ~/.ssh; fi&#34;
  run &#34;cat /tmp/#{key_file_name} &gt;&gt; ~/.ssh/authorized_keys&#34;
  run &#34;rm /tmp/#{key_file_name}&#34;
  run &#34;chmod 600 ~/.ssh/authorized_keys&#34;
end
Silky smooth.">
    <meta property="st:title" content="Capify - public key deployment">
    <meta property="og:title" content="Capify - public key deployment">
    <meta property="og:description" content="I’ve been playing with Capistrano a lot lately and loving it. Here is an example of how easy it is to write tasks and use them on multiple remote servers.
This task installs your SSH public key on the remote machine to allow key-based authentication:
set :key_file do
  Capistrano::CLI.ui.ask &#34;enter public key to push: &#34;
end

desc &#34;configures key-based SSH administration&#34;
task :push_key, :roles  =&gt; :all do
  key_location = File.expand_path(key_file)
  unless File.exist?(key_location) and key_file.match(/\.pub$/)
    puts &#34;Couldn&#39;t locate public key. Try again&#34;
    exit
  end
  key_file_name = File.basename(key_location)
  upload key_location, &#34;/tmp/#{key_file_name}&#34;
  run &#34;if [ ! -e ~/.ssh ];then mkdir ~/.ssh; fi&#34;
  run &#34;cat /tmp/#{key_file_name} &gt;&gt; ~/.ssh/authorized_keys&#34;
  run &#34;rm /tmp/#{key_file_name}&#34;
  run &#34;chmod 600 ~/.ssh/authorized_keys&#34;
end
Silky smooth.">
    <meta property="og:type" content="article">
    
    <meta property="og:image" content="/icon.png">
    
    
    <title>
      Capify - public key deployment | Jerod Santo
    </title>

    <link rel="icon" href="/icon.png" sizes="256x256" type="image/png">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" type="text/css" media="all" href="/styles.css">
    <script>
       
      window.grunticon=function(e){if(e&&3===e.length){var t=window,n=!(!t.document.createElementNS||!t.document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect||!document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#Image","1.1")||window.opera&&-1===navigator.userAgent.indexOf("Chrome")),o=function(o){var r=t.document.createElement("link"),a=t.document.getElementsByTagName("script")[0];r.rel="stylesheet",r.href=e[o&&n?0:o?1:2],a.parentNode.insertBefore(r,a)},r=new t.Image;r.onerror=function(){o(!1)},r.onload=function(){o(1===r.width&&1===r.height)},r.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw=="}};
      grunticon(["/icons/icons.data.svg.css", "/icons/icons.data.png.css", "/icons/icons.fallback.css"]);
    </script>

    <link href='//fonts.googleapis.com/css?family=Roboto+Condensed:400italic,400' rel='stylesheet' type='text/css'>
    <script src="//use.typekit.net/ozg5mvx.js"></script>
    <script>try{Typekit.load();}catch(e){}</script>
    <script src="/js/modernizr-custom.js"></script>

    

    <link rel="alternate" type="application/atom+xml" href="/index.xml" />
  </head>
  <body class="">
    
    <div class="main-header">
      <h1>
        <a href="/" title="Home">
          <span class="big-dot">&middot;</span> Jerod Santo <span class="big-dot">&middot;</span>
        </a>
      </h1>
      <a href="javascript:void(0);" title="Moar" class="main-header-more">+</a>
      <a href="/archives/" title="View Blog Archives" class="main-header-archive">Archives</a>
      <a href="mailto:jerod.santo@gmail.com" title="Contact Jerod" class="main-header-contact">Contact</a>
      <a href="/search/" title="Search the site" class="main-header-search">Search</a>
    </div>
    

    
<article class="post">
  <header class="post-header">
    <h1>Capify - public key deployment</h1>
    
    <p class="post-date">
      July 11, 2008
    </p>
  </header>

  

  <div class="post-content">
    <p>I’ve been playing with <a href="http://capify.org/">Capistrano</a> a lot lately and loving it. Here is an example of how easy it is to write tasks and use them on multiple remote servers.</p>
<p>This task installs your SSH public key on the remote machine to allow key-based authentication:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>set <span style="color:#032f62">:key_file</span> <span style="color:#cf222e">do</span>
</span></span><span style="display:flex;"><span>  <span style="color:#0550ae">Capistrano</span><span style="color:#0550ae">::</span><span style="color:#0550ae">CLI</span><span style="color:#0550ae">.</span>ui<span style="color:#0550ae">.</span>ask <span style="color:#0a3069">&#34;enter public key to push: &#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>desc <span style="color:#0a3069">&#34;configures key-based SSH administration&#34;</span>
</span></span><span style="display:flex;"><span>task <span style="color:#032f62">:push_key</span><span style="color:#1f2328">,</span> <span style="color:#032f62">:roles</span>  <span style="color:#0550ae">=&gt;</span> <span style="color:#032f62">:all</span> <span style="color:#cf222e">do</span>
</span></span><span style="display:flex;"><span>  key_location <span style="color:#0550ae">=</span> <span style="color:#0550ae">File</span><span style="color:#0550ae">.</span>expand_path<span style="color:#1f2328">(</span>key_file<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#cf222e">unless</span> <span style="color:#0550ae">File</span><span style="color:#0550ae">.</span>exist?<span style="color:#1f2328">(</span>key_location<span style="color:#1f2328">)</span> <span style="color:#0550ae">and</span> key_file<span style="color:#0550ae">.</span>match<span style="color:#1f2328">(</span><span style="color:#0a3069">/\.pub$/</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6639ba">puts</span> <span style="color:#0a3069">&#34;Couldn&#39;t locate public key. Try again&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6639ba">exit</span>
</span></span><span style="display:flex;"><span>  <span style="color:#cf222e">end</span>
</span></span><span style="display:flex;"><span>  key_file_name <span style="color:#0550ae">=</span> <span style="color:#0550ae">File</span><span style="color:#0550ae">.</span>basename<span style="color:#1f2328">(</span>key_location<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>  upload key_location<span style="color:#1f2328">,</span> <span style="color:#0a3069">&#34;/tmp/</span><span style="color:#0a3069">#{</span>key_file_name<span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span>
</span></span><span style="display:flex;"><span>  run <span style="color:#0a3069">&#34;if [ ! -e ~/.ssh ];then mkdir ~/.ssh; fi&#34;</span>
</span></span><span style="display:flex;"><span>  run <span style="color:#0a3069">&#34;cat /tmp/</span><span style="color:#0a3069">#{</span>key_file_name<span style="color:#0a3069">}</span><span style="color:#0a3069"> &gt;&gt; ~/.ssh/authorized_keys&#34;</span>
</span></span><span style="display:flex;"><span>  run <span style="color:#0a3069">&#34;rm /tmp/</span><span style="color:#0a3069">#{</span>key_file_name<span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span>
</span></span><span style="display:flex;"><span>  run <span style="color:#0a3069">&#34;chmod 600 ~/.ssh/authorized_keys&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">end</span>
</span></span></code></pre></div><p>Silky smooth.</p>

  </div>

  <ul class="post-share-buttons">
    <li class="service_twitter post-share-1">
      <a class="icon-twitter" href="https://twitter.com/intent/tweet?url=http%3a%2f%2flocalhost%3a1313%2f2008%2f07%2fcapify-public-key-deployment%2f&via=jerodsanto&text=Capify%20-%20public%20key%20deployment" title="Tweet">
        <span>Tweet</span>
      </a>
    </li>
    <li class="service_rss post-share-2">
      <a class="icon-rss" href="/index.xml" title="Subscribe to the feed!">
        <span>RSS</span>
      </a>
    </li>
    <li class="service_hackernews post-share-3">
      <a class="icon-hackernews" href="http://news.ycombinator.com/submitlink?u=http%3a%2f%2flocalhost%3a1313%2f2008%2f07%2fcapify-public-key-deployment%2f&t=Capify%20-%20public%20key%20deployment" title="Post to Hacker News">
        <span>Hacker News</span>
      </a>
    </li>
    <li class="service_instapaper post-share-4">
      <a class="icon-instapaper" href="http://www.instapaper.com/hello2?url=http%3a%2f%2flocalhost%3a1313%2f2008%2f07%2fcapify-public-key-deployment%2f&title=Capify%20-%20public%20key%20deployment" title="Read later">
        <span>Instapaper</span>
      </a>
    </li>
  </ul>

  
  

  <div id="disqus_thread"></div>
  <script>
    var disqus_url   = "http:\/\/localhost:1313\/2008\/07\/capify-public-key-deployment\/";
    var disqus_title = "Capify - public key deployment";
    (function() {
     var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
     dsq.src = 'https://blogt0sk1.disqus.com/embed.js';
     (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>

  <script src="//platform.twitter.com/widgets.js"></script>
</article>


    <footer class="main-footer">
  <p>
    Copyright &copy; 2008&mdash;2025 Jerod Santo
  </p>
</footer>

    
    <script src="/js/compiled.js"></script>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-3287978-16', 'auto');
      ga('send', 'pageview');
    </script>
    
  </body>
</html>