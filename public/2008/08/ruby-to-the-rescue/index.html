<!DOCTYPE html>



 <html class="no-js"> 
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="author" content="Jerod Santo">
    <meta property="og:site_name" content="Jerod Santo">
    
    <meta name="description" content="Ruby makes handling exceptions super simple. Lets assume you’re about to run a sketchy bit of code, like requesting a remote web site. It might look something like this:
require &#39;open-uri&#39;
url = &#34;http://slashdot.org/&#34;
doc = open(url)
Now, what if SlashDot is down for maintenance, overloaded with traffic, or has blocked your IP for scraping their site every 30 seconds? This code nugget will fail and your program will explode like a piñata during Puerto Rico Days. Let’s account for this and terminate our program gracefully:">
    <meta property="st:title" content="Ruby to the Rescue">
    <meta property="og:title" content="Ruby to the Rescue">
    <meta property="og:description" content="Ruby makes handling exceptions super simple. Lets assume you’re about to run a sketchy bit of code, like requesting a remote web site. It might look something like this:
require &#39;open-uri&#39;
url = &#34;http://slashdot.org/&#34;
doc = open(url)
Now, what if SlashDot is down for maintenance, overloaded with traffic, or has blocked your IP for scraping their site every 30 seconds? This code nugget will fail and your program will explode like a piñata during Puerto Rico Days. Let’s account for this and terminate our program gracefully:">
    <meta property="og:type" content="article">
    
    <meta property="og:image" content="/icon.png">
    
    
    <title>
      Ruby to the Rescue | Jerod Santo
    </title>

    <link rel="icon" href="/icon.png" sizes="256x256" type="image/png">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" type="text/css" media="all" href="/styles.css">
    <script>
       
      window.grunticon=function(e){if(e&&3===e.length){var t=window,n=!(!t.document.createElementNS||!t.document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect||!document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#Image","1.1")||window.opera&&-1===navigator.userAgent.indexOf("Chrome")),o=function(o){var r=t.document.createElement("link"),a=t.document.getElementsByTagName("script")[0];r.rel="stylesheet",r.href=e[o&&n?0:o?1:2],a.parentNode.insertBefore(r,a)},r=new t.Image;r.onerror=function(){o(!1)},r.onload=function(){o(1===r.width&&1===r.height)},r.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw=="}};
      grunticon(["/icons/icons.data.svg.css", "/icons/icons.data.png.css", "/icons/icons.fallback.css"]);
    </script>

    <link href='//fonts.googleapis.com/css?family=Roboto+Condensed:400italic,400' rel='stylesheet' type='text/css'>
    <script src="//use.typekit.net/ozg5mvx.js"></script>
    <script>try{Typekit.load();}catch(e){}</script>
    <script src="/js/modernizr-custom.js"></script>

    

    <link rel="alternate" type="application/atom+xml" href="/index.xml" />
  </head>
  <body class="">
    
    <div class="main-header">
      <h1>
        <a href="/" title="Home">
          <span class="big-dot">&middot;</span> Jerod Santo <span class="big-dot">&middot;</span>
        </a>
      </h1>
      <a href="javascript:void(0);" title="Moar" class="main-header-more">+</a>
      <a href="/archives/" title="View Blog Archives" class="main-header-archive">Archives</a>
      <a href="mailto:jerod.santo@gmail.com" title="Contact Jerod" class="main-header-contact">Contact</a>
      <a href="/search/" title="Search the site" class="main-header-search">Search</a>
    </div>
    

    
<article class="post">
  <header class="post-header">
    <h1>Ruby to the Rescue</h1>
    
    <p class="post-date">
      August 18, 2008
    </p>
  </header>

  

  <div class="post-content">
    <p>Ruby makes handling exceptions super simple. Lets assume you’re about to run a sketchy bit of code, like requesting a remote web site. It might look something like this:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#6639ba">require</span> <span style="color:#0a3069">&#39;open-uri&#39;</span>
</span></span><span style="display:flex;"><span>url <span style="color:#0550ae">=</span> <span style="color:#0a3069">&#34;http://slashdot.org/&#34;</span>
</span></span><span style="display:flex;"><span>doc <span style="color:#0550ae">=</span> <span style="color:#6639ba">open</span><span style="color:#1f2328">(</span>url<span style="color:#1f2328">)</span>
</span></span></code></pre></div><p>Now, what if <a href="http://slashdot.org/">SlashDot</a> is down for maintenance, overloaded with traffic, or has blocked your IP for scraping their site every 30 seconds? This code nugget will fail and your program will explode like a piñata during Puerto Rico Days. Let’s account for this and terminate our program gracefully:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#6639ba">require</span> <span style="color:#0a3069">&#39;open-uri&#39;</span>
</span></span><span style="display:flex;"><span>url <span style="color:#0550ae">=</span> <span style="color:#0a3069">&#34;http://slashdot.org/&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">begin</span>
</span></span><span style="display:flex;"><span>   doc <span style="color:#0550ae">=</span> <span style="color:#6639ba">open</span><span style="color:#1f2328">(</span>url<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">rescue</span>
</span></span><span style="display:flex;"><span>   <span style="color:#6639ba">puts</span> <span style="color:#0a3069">&#34;The request for a page at </span><span style="color:#0a3069">#{</span>url<span style="color:#0a3069">}</span><span style="color:#0a3069"> timed out...exiting.&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#6639ba">exit</span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">end</span>
</span></span></code></pre></div><p>Ahh, that’s better! But what if we’re iterating a list of url’s and scraping pages? Maybe we don’t want to exit the program at all, but continue with the next url in the list. I’ll demo with 3 urls:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#6639ba">require</span> <span style="color:#0a3069">&#39;open-uri&#39;</span>
</span></span><span style="display:flex;"><span>urls <span style="color:#0550ae">=</span> <span style="color:#0a3069">%w[ http://slashdot.org/ http://news.ycombinator.com/ http://www.techmeme.com/ ]</span>
</span></span><span style="display:flex;"><span>urls<span style="color:#0550ae">.</span>each <span style="color:#cf222e">do</span> <span style="color:#0550ae">|</span>url<span style="color:#0550ae">|</span>
</span></span><span style="display:flex;"><span>  <span style="color:#cf222e">begin</span>
</span></span><span style="display:flex;"><span>    doc <span style="color:#0550ae">=</span> <span style="color:#6639ba">open</span><span style="color:#1f2328">(</span>url<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#cf222e">rescue</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6639ba">puts</span> <span style="color:#0a3069">&#34;The request for a page at </span><span style="color:#0a3069">#{</span>url<span style="color:#0a3069">}</span><span style="color:#0a3069"> timed out...skipping.&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">next</span>
</span></span><span style="display:flex;"><span>  <span style="color:#cf222e">end</span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">end</span>
</span></span></code></pre></div><p>Now we safely output the offending error and continue with the next value in the urls array. That’s naace!</p>
<p>The truth is that this will not catch all exceptions. The problem is that when using the open-uri class you can receive an <code>OpenURI::Error</code> if the site you’re trying to access returns a 404, 403, 500 or other “not good” response, and you can receive a <code>Timeout::Error</code> if the site simply doesn’t respond at all and the request times out. Let’s modify our nugget to handle both scenarios:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#6639ba">require</span> <span style="color:#0a3069">&#39;open-uri&#39;</span>
</span></span><span style="display:flex;"><span>urls <span style="color:#0550ae">=</span> <span style="color:#0a3069">%w[ http://slashdot.org/ http://news.ycombinator.com/ http://www.techmeme.com/ ]</span>
</span></span><span style="display:flex;"><span>urls<span style="color:#0550ae">.</span>each <span style="color:#cf222e">do</span> <span style="color:#0550ae">|</span>url<span style="color:#0550ae">|</span>
</span></span><span style="display:flex;"><span>  <span style="color:#cf222e">begin</span>
</span></span><span style="display:flex;"><span>    doc <span style="color:#0550ae">=</span> <span style="color:#6639ba">open</span><span style="color:#1f2328">(</span>url<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#cf222e">rescue</span> <span style="color:#0550ae">Timeout</span><span style="color:#0550ae">::</span><span style="color:#0550ae">Error</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6639ba">puts</span> <span style="color:#0a3069">&#34;The request for a page at </span><span style="color:#0a3069">#{</span>url<span style="color:#0a3069">}</span><span style="color:#0a3069"> timed out...skipping.&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">next</span>
</span></span><span style="display:flex;"><span>  <span style="color:#cf222e">rescue</span> <span style="color:#0550ae">OpenURI</span><span style="color:#0550ae">::</span><span style="color:#0550ae">Error</span> <span style="color:#0550ae">=&gt;</span> e
</span></span><span style="display:flex;"><span>    <span style="color:#6639ba">puts</span> <span style="color:#0a3069">&#34;The request for a page at </span><span style="color:#0a3069">#{</span>url<span style="color:#0a3069">}</span><span style="color:#0a3069"> returned an error. </span><span style="color:#0a3069">#{</span>e<span style="color:#0550ae">.</span>message<span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">next</span>
</span></span><span style="display:flex;"><span>  <span style="color:#cf222e">end</span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">end</span>
</span></span></code></pre></div><p>You can use multiple <code>rescue</code> blocks to handle multiple exception classes. Now we should have a bullet-proof code nugget. See any chinks in the armor? Let me know in the comments.</p>

  </div>

  <ul class="post-share-buttons">
    <li class="service_twitter post-share-1">
      <a class="icon-twitter" href="https://twitter.com/intent/tweet?url=http%3a%2f%2flocalhost%3a1313%2f2008%2f08%2fruby-to-the-rescue%2f&via=jerodsanto&text=Ruby%20to%20the%20Rescue" title="Tweet">
        <span>Tweet</span>
      </a>
    </li>
    <li class="service_rss post-share-2">
      <a class="icon-rss" href="/index.xml" title="Subscribe to the feed!">
        <span>RSS</span>
      </a>
    </li>
    <li class="service_hackernews post-share-3">
      <a class="icon-hackernews" href="http://news.ycombinator.com/submitlink?u=http%3a%2f%2flocalhost%3a1313%2f2008%2f08%2fruby-to-the-rescue%2f&t=Ruby%20to%20the%20Rescue" title="Post to Hacker News">
        <span>Hacker News</span>
      </a>
    </li>
    <li class="service_instapaper post-share-4">
      <a class="icon-instapaper" href="http://www.instapaper.com/hello2?url=http%3a%2f%2flocalhost%3a1313%2f2008%2f08%2fruby-to-the-rescue%2f&title=Ruby%20to%20the%20Rescue" title="Read later">
        <span>Instapaper</span>
      </a>
    </li>
  </ul>

  
  

  <div id="disqus_thread"></div>
  <script>
    var disqus_url   = "http:\/\/localhost:1313\/2008\/08\/ruby-to-the-rescue\/";
    var disqus_title = "Ruby to the Rescue";
    (function() {
     var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
     dsq.src = 'https://blogt0sk1.disqus.com/embed.js';
     (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>

  <script src="//platform.twitter.com/widgets.js"></script>
</article>


    <footer class="main-footer">
  <p>
    Copyright &copy; 2008&mdash;2025 Jerod Santo
  </p>
</footer>

    
    <script src="/js/compiled.js"></script>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-3287978-16', 'auto');
      ga('send', 'pageview');
    </script>
    
  </body>
</html>